********** Purpose: Macro To Download Data from NHANES website *********
********** Author: Tendai Gwanzura**************************************;
%macro CreateDS(myDS);
  %let i = 1;
  %let DS = %scan(&myDS, &i);

  %do %until(&DS = %nrstr());
    %let Suffix = %lowcase(%substr(&DS, %eval(%length(&DS)-1)));
    %if       (&Suffix = _j) %then %do; filename xptIn url "https://wwwn.cdc.gov/nchs/nhanes/2017-2018/&DS..xpt"; %end;
	%else %if (&Suffix = _i) %then %do; filename xptIn url "https://wwwn.cdc.gov/nchs/nhanes/2017-2020/&DS..xpt"; %end;
    %else %if (&Suffix = _i) %then %do; filename xptIn url "https://wwwn.cdc.gov/nchs/nhanes/2015-2016/&DS..xpt"; %end;
    %else %if (&Suffix = _h) %then %do; filename xptIn url "https://wwwn.cdc.gov/nchs/nhanes/2013-2014/&DS..xpt"; %end;
    %else %if (&Suffix = _g) %then %do; filename xptIn url "https://wwwn.cdc.gov/nchs/nhanes/2011-2012/&DS..xpt"; %end;
    %else %if (&Suffix = _f) %then %do; filename xptIn url "https://wwwn.cdc.gov/nchs/nhanes/2009-2010/&DS..xpt"; %end;
    %else %if (&Suffix = _e) %then %do; filename xptIn url "https://wwwn.cdc.gov/nchs/nhanes/2007-2008/&DS..xpt"; %end;
    %else %if (&Suffix = _d) %then %do; filename xptIn url "https://wwwn.cdc.gov/nchs/nhanes/2005-2006/&DS..xpt"; %end;
    %else %if (&Suffix = _c) %then %do; filename xptIn url "https://wwwn.cdc.gov/nchs/nhanes/2003-2004/&DS..xpt"; %end;
    %else %if (&Suffix = _b) %then %do; filename xptIn url "https://wwwn.cdc.gov/nchs/nhanes/2001-2002/&DS..xpt"; %end;
    %else %do; filename xptIn url "https://wwwn.cdc.gov/nchs/nhanes/1999-2000/&DS..xpt"; %end;
    libname xptIn xport;

    data &DS;
      set xptIn.&DS;
    run;

    libname xptIn clear;
    filename xptIn clear;

    %let i = %eval(&i+1);
    %let DS = %scan(&myDS, &i);
  %end;
%mend CreateDS;

** Call macro to import datafiles for multiple individual components **;

* Questanniare (QES) *;
* Cadmium, Lead, & Total Mercury - Blood (named L06BMT_C for 2003-2004, PbCd_x for 2005-2006 and 2007-2008) *;

%CreateDS(ACQ_D 
ACQ_E 
ACQ 
ACQ_C 
ACQ_B 
ACQ_F 
ACQ_G 
ACQ_H 
ACQ_I 
ACQ_J 
P_ACQ 
AQQ_E 
AQQ_F 
ALQ_D 
ALQ_E 
ALQ 
ALQ_C 
ALQ_B 
ALQ_F 
ALQ_G 
ALQ_H 
ALQ_I 
ALQ_J 
P_ALQ 
ALQY_F 
AGQ_D 
RXQ_ANA 
RXQANA_C 
RXQANA_B 
ARQ_F 
AUQ_E 
AUQ 
AUQ_D 
AUQ_C 
AUQ_B 
AUQ_F 
AUQ_G 
AUQ_I 
AUQ_J 
P_AUQ 
BAQ 
BAQ_C 
BAQ_B 
BPQ_D 
BPQ_E 
BPQ 
BPQ_C 
BPQ_B 
BPQ_F 
BPQ_G 
BPQ_H 
BPQ_I 
BPQ_J 
P_BPQ 
BHQ_D 
BHQ_E 
BHQ_F 
CDQ_D 
CDQ_E 
CDQ 
CDQ_C 
CDQ_B 
CDQ_F 
CDQ_G 
CDQ_H 
CDQ_I 
CDQ_J 
P_CDQ 
CFQ 
CFQ_B 
CFQ_G 
CFQ_H 
CBQ_E 
CBQ_F 
CBQ_G 
CBQ_H 
CBQ_I 
CBQ_J 
CBQPFA_E 
CBQPFA_F 
CBQPFA_J 
CBQPFC_E 
CBQPFC_F 
CBQPFC_J 
CKQ_G 
CKQ_H 
HSQ_D 
HSQ_E 
HSQ 
HSQ_C 
HSQ_B 
HSQ_F 
HSQ_G 
HSQ_H 
HSQ_I 
HSQ_J 
P_HSQ 
DEQ_D 
DEQ 
DEQ_C 
DEQ_B 
DEQ_F 
DEQ_H 
DEQ_G 
DEQ_I 
DEQ_J 
P_DEQ 
DIQ_E 
DIQ 
DIQ_D 
DIQ_C 
DIQ_B 
DIQ_F 
DIQ_G 
DIQ_H 
DIQ_I 
DIQ_J 
P_DIQ 
DBQ_D 
DBQ 
DBQ_E 
DBQ_C 
DBQ_B 
DBQ_F 
DBQ_G 
DBQ_H 
DBQ_I 
DBQ_J 
P_DBQ 
DLQ_H 
DLQ_I 
DLQ_J 
DUQ_E 
DUQ 
DUQ_D 
DUQ_C 
DUQ_B 
DUQ_F 
DUQ_G 
DUQ_H 
DUQ_I 
DUQ_J 
ECQ_E 
ECQ 
ECQ_D 
ECQ_C 
ECQ_B 
ECQ_F 
ECQ_G 
ECQ_H 
ECQ_I 
ECQ_J 
P_ECQ 
FSQ 
FSQ_E 
FSQ_D 
FSQ_C 
FSQ_B 
FSQ_F 
FSQ_G 
FSQ_H 
FSQ_I 
FSQ_J 
P_FSQ 
HIQ_E 
HIQ 
HIQ_D 
HIQ_C 
HIQ_B 
HIQ_F 
HIQ_G 
HIQ_H 
HIQ_I 
HIQ_J 
P_HIQ 
HEQ_H 
HEQ_I 
HEQ_J 
P_HEQ 
HCQ_E 
HCQ_D 
HCQ_C 
HCQ_B 
HCQ_F 
HCQ_G 
HUQ_E 
HUQ 
HUQ_D 
HUQ_C 
HUQ_B 
HUQ_F 
HUQ_G 
HUQ_H 
HUQ_I 
HUQ_J 
P_HUQ 
HOQ_E 
HOQ 
HOQ_D 
HOQ_C 
HOQ_B 
HOQ_F 
HOQ_G 
HOQ_H 
HOQ_I 
HOQ_J 
IMQ_E 
IMQ 
IMQ_D 
IMQ_C 
IMQ_B 
IMQ_F 
IMQ_G 
IMQ_H 
IMQ_I 
IMQ_J 
P_IMQ 
INQ_E 
INQ_F 
INQ_G 
INQ_H 
INQ_I 
INQ_J 
P_INQ 
KIQ 
KIQ_U_E 
KIQ_U_D 
KIQ_U_C 
KIQ_U_B 
KIQ_U_F 
KIQ_U_G 
KIQ_U_H 
KIQ_U_I 
KIQ_U_J 
P_KIQ_U 
MCQ_E 
MCQ 
MCQ_D 
MCQ_C 
MCQ_B 
MCQ_F 
MCQ_G 
MCQ_H 
MCQ_I 
MCQ_J 
P_MCQ 
CIQMDEP 
CIQDEP_C 
CIQDEP_B 
DPQ_D 
DPQ_E 
DPQ_F 
DPQ_G 
DPQ_H 
DPQ_I 
DPQ_J 
P_DPQ 
CIQGAD 
CIQGAD_C 
CIQGAD_B 
CIQPANIC 
CIQPAN_C 
CIQPAN_B 
MPQ 
MPQ_C 
MPQ_B 
OCQ 
OCQ_C 
OCQ_B 
OCQ_D 
OCQ_E 
OCQ_F 
OCQ_G 
OCQ_H 
OCQ_I 
OCQ_J 
P_OCQ 
OHQ_E 
OHQ 
OHQ_D 
OHQ_C 
OHQ_B 
OHQ_F 
OHQ_G 
OHQ_H 
OHQ_I 
OHQ_J 
P_OHQ 
OSQ_E 
OSQ 
OSQ_D 
OSQ_C 
OSQ_B 
OSQ_F 
OSQ_H 
OSQ_J 
P_OSQ 
PUQMEC_E 
PUQ 
PUQMEC_D 
PUQ_C 
PUQ_B 
PUQMEC_F 
PUQMEC_G 
PUQMEC_H 
PUQMEC_I 
PUQMEC_J 
P_PUQMEC 
PAQ_E 
PAQ 
PAQ_D 
PAQ_C 
PAQ_B 
PAQ_F 
PAQ_G 
PAQ_H 
PAQ_I 
PAQ_J 
P_PAQ 
PAQIAF 
PAQIAF_D 
PAQIAF_C 
PAQIAF_B 
PAQY_J 
P_PAQY 
PFQ_E 
PFQ 
PFQ_D 
PFQ_C 
PFQ_B 
PFQ_F 
PFQ_G 
PFQ_H 
PFQ_I 
PFQ_J 
RXQ_RX 
RXQ_RX_E 
RXQ_RX_D 
RXQ_RX_C 
RXQ_RX_B 
RXQ_RX_F 
RXQ_RX_G 
RXQ_RX_H 
RXQ_RX_I 
RXQ_RX_J 
P_RXQ_RX 
RXQASA_G 
RXQASA_H 
RXQASA_I 
RXQASA_J 
P_RXQASA 
KIQ_P_E 
KIQ_P_D 
KIQ_P_C 
KIQ_P_B 
PSQ_D 
PSQ_C 
RHQ_E 
RHQ 
RHQ_D 
RHQ_C 
RHQ_B 
RHQ_F 
RHQ_G 
RHQ_H 
RHQ_I 
RHQ_J 
P_RHQ 
RDQ_E 
RDQ 
RDQ_D 
RDQ_C 
RDQ_B 
RDQ_F 
RDQ_G 
SXQ_E 
SXQ 
SXQ_D 
SXQ_C 
SXQ_B 
SXQ_F 
SXQ_G 
SXQ_H 
SXQ_I 
SLQ_E 
SLQ_D 
SLQ_F 
SLQ_G 
SLQ_H 
SLQ_I 
SLQ_J 
P_SLQ 
SMQMEC 
SMQMEC_C 
SMQMEC_B 
SMQ_E 
SMQ_D 
SMQ_F 
SMQ_G 
SMQ_H 
SMQ_I 
SMQ_J 
P_SMQ 
SMQ 
SMQ_C 
SMQ_B 
SMQFAM_E 
SMQFAM_D 
SMQFAM_C 
SMQFAM_B 
SMQFAM 
SMQFAM_F 
SMQFAM_G 
SMQFAM_H 
SMQFAM_I 
SMQFAM_J 
P_SMQFAM 
SMQRTU_E 
SMQRTU_D 
SMQRTU_F 
SMQRTU_G 
SMQRTU_H 
SMQRTU_I 
SMQRTU_J 
P_SMQRTU 
SMQSHS_H 
SMQSHS_I 
SMQSHS_J 
P_SMQSHS 
SSQ_E 
SSQ 
SSQ_D 
SSQ_C 
SSQ_B 
CSQ_G 
CSQ_H 
TBQ 
TBQ_G 
VIQ_E 
VIQ 
VIQ_D 
VIQ_C 
VIQ_B 
VTQ_I 
VTQ_J 
P_VTQ 
VTQ_H 
VTQ_G 
VTQ_F 
WHQ_E 
WHQ 
WHQ_B 
WHQ_D 
WHQ_C 
WHQ_F 
WHQ_G 
WHQ_H 
WHQ_I 
WHQ_J 
P_WHQ 
WHQMEC_E 
WHQMEC_D 
WHQMEC_F 
WHQMEC_G 
WHQMEC_H 
WHQMEC_I 
WHQMEC_J 
P_WHQMEC; 

proc contents data= P_ACQ;
run;
data Questionnaire_data;
merge ACQ_D 
ACQ_E 
ACQ 
ACQ_C 
ACQ_B 
ACQ_F 
ACQ_G 
ACQ_H 
ACQ_I 
ACQ_J 
 
AQQ_E 
AQQ_F 
ALQ_D 
ALQ_E 
ALQ 
ALQ_C 
ALQ_B 
ALQ_F 
ALQ_G 
ALQ_H 
ALQ_I 
ALQ_J 

ALQY_F 
AGQ_D 
RXQ_ANA 
RXQANA_C 
RXQANA_B 
ARQ_F 
AUQ_E 
AUQ 
AUQ_D 
AUQ_C 
AUQ_B 
AUQ_F 
AUQ_G 
AUQ_I 
AUQ_J 

BAQ 
BAQ_C 
BAQ_B 
BPQ_D 
BPQ_E 
BPQ 
BPQ_C 
BPQ_B 
BPQ_F 
BPQ_G 
BPQ_H 
BPQ_I 
BPQ_J 
 
BHQ_D 
BHQ_E 
BHQ_F 
CDQ_D 
CDQ_E 
CDQ 
CDQ_C 
CDQ_B 
CDQ_F 
CDQ_G 
CDQ_H 
CDQ_I 
CDQ_J 

CFQ 
CFQ_B 
CFQ_G 
CFQ_H 
CBQ_E 
CBQ_F 
CBQ_G 
CBQ_H 
CBQ_I 
CBQ_J 
CBQPFA_E 
CBQPFA_F 
CBQPFA_J 
CBQPFC_E 
CBQPFC_F 
CBQPFC_J 
CKQ_G 
CKQ_H 
HSQ_D 
HSQ_E 
HSQ 
HSQ_C 
HSQ_B 
HSQ_F 
HSQ_G 
HSQ_H 
HSQ_I 
HSQ_J 
 
DEQ_D 
DEQ 
DEQ_C 
DEQ_B 
DEQ_F 
DEQ_H 
DEQ_G 
DEQ_I 
DEQ_J 

DIQ_E 
DIQ 
DIQ_D 
DIQ_C 
DIQ_B 
DIQ_F 
DIQ_G 
DIQ_H 
DIQ_I 
DIQ_J 
 
DBQ_D 
DBQ 
DBQ_E 
DBQ_C 
DBQ_B 
DBQ_F 
DBQ_G 
DBQ_H 
DBQ_I 
DBQ_J 
P_DBQ 
DLQ_H 
DLQ_I 
DLQ_J 
DUQ_E 
DUQ 
DUQ_D 
DUQ_C 
DUQ_B 
DUQ_F 
DUQ_G 
DUQ_H 
DUQ_I 
DUQ_J 
ECQ_E 
ECQ 
ECQ_D 
ECQ_C 
ECQ_B 
ECQ_F 
ECQ_G 
ECQ_H 
ECQ_I 
ECQ_J 
P_ECQ 
FSQ 
FSQ_E 
FSQ_D 
FSQ_C 
FSQ_B 
FSQ_F 
FSQ_G 
FSQ_H 
FSQ_I 
FSQ_J 
P_FSQ 
HIQ_E 
HIQ 
HIQ_D 
HIQ_C 
HIQ_B 
HIQ_F 
HIQ_G 
HIQ_H 
HIQ_I 
HIQ_J 
P_HIQ 
HEQ_H 
HEQ_I 
HEQ_J 
P_HEQ 
HCQ_E 
HCQ_D 
HCQ_C 
HCQ_B 
HCQ_F 
HCQ_G 
HUQ_E 
HUQ 
HUQ_D 
HUQ_C 
HUQ_B 
HUQ_F 
HUQ_G 
HUQ_H 
HUQ_I 
HUQ_J 
P_HUQ 
HOQ_E 
HOQ 
HOQ_D 
HOQ_C 
HOQ_B 
HOQ_F 
HOQ_G 
HOQ_H 
HOQ_I 
HOQ_J 
IMQ_E 
IMQ 
IMQ_D 
IMQ_C 
IMQ_B 
IMQ_F 
IMQ_G 
IMQ_H 
IMQ_I 
IMQ_J 
P_IMQ 
INQ_E 
INQ_F 
INQ_G 
INQ_H 
INQ_I 
INQ_J 
P_INQ 
KIQ 
KIQ_U_E 
KIQ_U_D 
KIQ_U_C 
KIQ_U_B 
KIQ_U_F 
KIQ_U_G 
KIQ_U_H 
KIQ_U_I 
KIQ_U_J 
P_KIQ_U 
MCQ_E 
MCQ 
MCQ_D 
MCQ_C 
MCQ_B 
MCQ_F 
MCQ_G 
MCQ_H 
MCQ_I 
MCQ_J 
P_MCQ 
CIQMDEP 
CIQDEP_C 
CIQDEP_B 
DPQ_D 
DPQ_E 
DPQ_F 
DPQ_G 
DPQ_H 
DPQ_I 
DPQ_J 
P_DPQ 
CIQGAD 
CIQGAD_C 
CIQGAD_B 
CIQPANIC 
CIQPAN_C 
CIQPAN_B 
MPQ 
MPQ_C 
MPQ_B 
OCQ 
OCQ_C 
OCQ_B 
OCQ_D 
OCQ_E 
OCQ_F 
OCQ_G 
OCQ_H 
OCQ_I 
OCQ_J 
P_OCQ 
OHQ_E 
OHQ 
OHQ_D 
OHQ_C 
OHQ_B 
OHQ_F 
OHQ_G 
OHQ_H 
OHQ_I 
OHQ_J 
P_OHQ 
OSQ_E 
OSQ 
OSQ_D 
OSQ_C 
OSQ_B 
OSQ_F 
OSQ_H 
OSQ_J 
P_OSQ 
PUQMEC_E 
PUQ 
PUQMEC_D 
PUQ_C 
PUQ_B 
PUQMEC_F 
PUQMEC_G 
PUQMEC_H 
PUQMEC_I 
PUQMEC_J 
P_PUQMEC 
PAQ_E 
PAQ 
PAQ_D 
PAQ_C 
PAQ_B 
PAQ_F 
PAQ_G 
PAQ_H 
PAQ_I 
PAQ_J 
P_PAQ 
PAQIAF 
PAQIAF_D 
PAQIAF_C 
PAQIAF_B 
PAQY_J 
P_PAQY 
PFQ_E 
PFQ 
PFQ_D 
PFQ_C 
PFQ_B 
PFQ_F 
PFQ_G 
PFQ_H 
PFQ_I 
PFQ_J 
RXQ_RX 
RXQ_RX_E 
RXQ_RX_D 
RXQ_RX_C 
RXQ_RX_B 
RXQ_RX_F 
RXQ_RX_G 
RXQ_RX_H 
RXQ_RX_I 
RXQ_RX_J 
P_RXQ_RX 
RXQASA_G 
RXQASA_H 
RXQASA_I 
RXQASA_J  
KIQ_P_E 
KIQ_P_D 
KIQ_P_C 
KIQ_P_B 
PSQ_D 
PSQ_C 
RHQ_E 
RHQ 
RHQ_D 
RHQ_C 
RHQ_B 
RHQ_F 
RHQ_G 
RHQ_H 
RHQ_I 
RHQ_J 
 
RDQ_E 
RDQ 
RDQ_D 
RDQ_C 
RDQ_B 
RDQ_F 
RDQ_G 
SXQ_E 
SXQ 
SXQ_D 
SXQ_C 
SXQ_B 
SXQ_F 
SXQ_G 
SXQ_H 
SXQ_I 
SLQ_E 
SLQ_D 
SLQ_F 
SLQ_G 
SLQ_H 
SLQ_I 
SLQ_J 
 
SMQMEC 
SMQMEC_C 
SMQMEC_B 
SMQ_E 
SMQ_D 
SMQ_F 
SMQ_G 
SMQ_H 
SMQ_I 
SMQ_J 
 
SMQ 
SMQ_C 
SMQ_B 
SMQFAM_E 
SMQFAM_D 
SMQFAM_C 
SMQFAM_B 
SMQFAM 
SMQFAM_F 
SMQFAM_G 
SMQFAM_H 
SMQFAM_I 
SMQFAM_J 

SMQRTU_E 
SMQRTU_D 
SMQRTU_F 
SMQRTU_G 
SMQRTU_H 
SMQRTU_I 
SMQRTU_J 

SMQSHS_H 
SMQSHS_I 
SMQSHS_J 
 
SSQ_E 
SSQ 
SSQ_D 
SSQ_C 
SSQ_B 
CSQ_G 
CSQ_H 
TBQ 
TBQ_G 
VIQ_E 
VIQ 
VIQ_D 
VIQ_C 
VIQ_B 
VTQ_I 
VTQ_J 
 
VTQ_H 
VTQ_G 
VTQ_F 
WHQ_E 
WHQ 
WHQ_B 
WHQ_D 
WHQ_C 
WHQ_F 
WHQ_G 
WHQ_H 
WHQ_I 
WHQ_J 
 
WHQMEC_E 
WHQMEC_D 
WHQMEC_F 
WHQMEC_G 
WHQMEC_H 
WHQMEC_I 
WHQMEC_J 
;
by SEQN;
run;
proc cntents data= P_ALQ;
run;

*convert to csv; 
proc export data=Acq;
    outfile="C:\Users\tenda\Downloads\ACQ_D.csv"
    dbms=csv
	replace;
run;
